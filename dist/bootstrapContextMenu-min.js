"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};angular.module("bootstrapContextMenu",[]).controller("ContextMenuController",["$scope","$document","$element","$window",function(e,t,n,o){var a=this,r=!1,l=[],u=!1,i=37,f=39,c=38,s=40,d=13,m=0,p=0,h=function(e){var t=null;return angular.forEach(l,function(n){n.depth==e&&(t=n)}),t},v=function(t){return"boolean"==typeof t.enabled?t.enabled:"string"!=typeof t.enabled||e.$eval(t.enabled)},g=function(e,t,n){e.css({position:"absolute",left:t+"px",top:n+"px","z-index":99999})},b=function(t){if(v(t)){switch(_typeof(t.click)){case"function":t.click();break;case"string":e.$eval(t.click);break;default:return}a.hide()}},y=function(e,t,n){var r=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];if(l[m]&&!r){var i=l[m],f=i.buttons[p];f.element.removeClass("active"),p=0,m=0}var c=[];if(angular.forEach(l,function(t){t.depth>e.depth&&c.push(t)}),angular.forEach(c,function(e){return a.removeMenu(e)}),n.submenu){var s=angular.element(t).offset(),d=e.element.width(),h=s.left+d,v=s.top,b=a.addMenu(h,v,n.submenu,e.depth+1,t);v=b.element.offset().top,g(b.element,0,0);var y=b.element.width();g(b.element,h,v),(u||h+y>angular.element(o).width())&&(h=s.left-y,g(b.element,h,v),u=!0)}};this.addMenu=function(e,n,a){var r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],u=arguments.length<=4||void 0===arguments[4]?null:arguments[4];if("object"!==("undefined"==typeof a?"undefined":_typeof(a)))return null;var i=angular.element("<div>");i.addClass("list-group context-menu"),i.attr({role:"group"});var f={element:i,buttons:[],depth:r,parentButtonElement:u};angular.forEach(a,function(e){if("object"===("undefined"==typeof e?"undefined":_typeof(e))){var t=angular.element("<a>");if(t.addClass("list-group-item context-menu-item"),t.append(e.text+"&nbsp;"),t.attr({href:"#"}),e.submenu){var n=angular.element("<span>");n.addClass("glyphicon glyphicon-triangle-right pull-right"),t.append(n)}i.append(t);var o=v(e);o?(t.on("click",function(t){return b(e)}),t.on("mouseover",function(n){return y(f,t,e)})):t.addClass("disabled"),f.buttons.push({element:t,item:e})}}),angular.element(t).find("body").append(i),l.push(f),g(i,0,0);var c=i.height();return n=Math.min(n,angular.element(o).height()-c+o.pageYOffset),g(i,e,n),f},this.removeMenu=function(e){if(r){var t=l.indexOf(e);t<0||(l.splice(t,1),e.element.remove())}},this.show=function(e,t,n){r=!0,u=!1;var l=a.addMenu(e,t,n);t=l.element.offset().top,g(l.element,0,0);var i=l.element.width();g(l.element,e,t),e+i>angular.element(o).width()&&(e-=i,g(l.element,e,t),u=!0)},this.hide=function(){r&&(r=!1,angular.forEach(l,function(e){e.element.remove()}),l=[])},t.on("mousedown",function(e){r&&(angular.element(e.target).hasClass("context-menu")||angular.element(e.target).hasClass("context-menu-item")||a.hide())}),t.on("keydown",function(e){if(r){var t=l[m];if(!t)return m=0,void(p=0);var n=t.buttons[p],o=p;switch(e.keyCode){case u?f:i:var a=h(t.depth-1);if(a){var v=0;angular.forEach(a.buttons,function(e,n){if(e.element==t.parentButtonElement)return void(v=n)}),m=l.indexOf(a),t=l[m],o=-1,p=v}break;case u?i:f:if(n.item.submenu){var g=h(t.depth+1);g&&(m=l.indexOf(g),t=l[m],o=-1,p=0)}break;case c:p--,p<0&&(p=t.buttons.length-1);break;case s:p++,p>=t.buttons.length&&(p=0);break;case d:b(n.item)}p!=o&&(e.preventDefault(),n.element.removeClass("active"),n=t.buttons[p],n.element.addClass("active"),y(t,n.element,n.item,!0))}})}]).directive("contextMenu",["$rootScope",function(e){return{controller:"ContextMenuController",link:function(t,n,o,a){n.on("contextmenu",function(n){e.$apply(function(){n.preventDefault(),n.stopPropagation(),e.activeContextMenuController&&e.activeContextMenuController.hide();var r=t.$eval(o.contextMenu);a.show(n.pageX,n.pageY,r),e.activeContextMenuController=a})})}}}]);